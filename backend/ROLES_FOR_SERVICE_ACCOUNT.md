# Роли для сервисного аккаунта HappyRussia

## Необходимые роли

Для работы бекенда сервисному аккаунту нужно назначить следующие роли:

### 1. Container Registry
Найдите категорию **`container-registry`** и выберите:
- **`images.pusher`** - Загрузка образов в Container Registry
- **`images.puller`** - Загрузка образов из Container Registry (опционально, но рекомендуется)

### 2. Serverless Containers
Найдите категорию **`serverless.containers`** (с точкой) и выберите:
- **`editor`** - Редактор (включает развертывание контейнеров)
- **`invoker`** - Вызов контейнеров (для работы API)

**Альтернатива:** Вместо `editor` можно использовать `admin`, но это дает больше прав, чем нужно.

## Как назначить роли через веб-консоль

### Шаг 1: Откройте сервисный аккаунт

1. Перейдите в [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Выберите ваш каталог (folder)
3. В меню слева выберите **"Сервисные аккаунты"** (IAM → Сервисные аккаунты)
4. Найдите или создайте сервисный аккаунт `happyrussia-sa`
5. Нажмите на имя сервисного аккаунта

### Шаг 2: Назначение ролей на уровне каталога

1. В карточке сервисного аккаунта перейдите на вкладку **"Права доступа"**
2. Нажмите **"Назначить роли"**
3. Выберите **"На уровне каталога"**
4. Выберите ваш каталог из списка
5. Добавьте следующие роли (по одной или все сразу):

#### Роли для добавления:

**В категории `container-registry`:**
- `images.pusher`
- `images.puller` (опционально)

**В категории `serverless.containers` (с точкой):**
- `editor` (или `admin` для полного доступа)
- `invoker`

6. Нажмите **"Сохранить"**

### Альтернативный способ: Через раздел "Права доступа" каталога

1. Перейдите в ваш каталог
2. Откройте вкладку **"Права доступа"**
3. Нажмите **"Назначить роли"**
4. В поле **"Выберите пользователя"** введите имя сервисного аккаунта: `happyrussia-sa`
5. Выберите сервисный аккаунт из списка
6. Выберите роли:
   - `container-registry.images.pusher`
   - `container-registry.images.puller` (опционально)
   - `serverless.containers.deployer`
   - `serverless.containers.invoker`
7. Нажмите **"Сохранить"**

## Проверка назначенных ролей

После назначения ролей вы должны увидеть их в списке прав доступа сервисного аккаунта.

## Минимальный набор ролей (если хотите только необходимые)

Если хотите назначить только минимально необходимые роли:

1. **`container-registry` → `images.pusher`** - обязательно (для загрузки образов)
2. **`serverless.containers` → `editor`** - обязательно (для развертывания контейнеров)
3. **`serverless.containers` → `invoker`** - обязательно (для работы API)

⚠️ **Важно:** Выбирайте категорию `serverless.containers` (с точкой), а не `serverless-containers` (с дефисом)!

## Дополнительные роли (для расширенного управления)

Если планируете управлять ресурсами через сервисный аккаунт:

- **`editor`** - Редактор (полный доступ к ресурсам каталога, кроме управления правами)
- **`viewer`** - Просмотрщик (только просмотр ресурсов)

⚠️ **Внимание:** Роль `editor` дает широкие права доступа. Используйте только если действительно нужно.

## Краткая инструкция (быстрый вариант)

1. Консоль → Ваш каталог → **Права доступа**
2. **Назначить роли**
3. Выбрать сервисный аккаунт `happyrussia-sa`
4. Найти и добавить роли:

   **В категории `container-registry`:**
   - `images.pusher`
   
   **В категории `serverless.containers` (с точкой!):**
   - `editor`
   - `invoker`
5. **Сохранить**

## После назначения ролей

После успешного назначения ролей вы можете:

1. ✅ Использовать сервисный аккаунт для развертывания через CLI
2. ✅ Загружать Docker образы в Container Registry
3. ✅ Развертывать Serverless Containers

## Проблемы

### Ошибка: "Недостаточно прав"

**Решение:** Убедитесь, что ваш пользователь имеет роль `admin` или `resource-manager.admin` на уровне каталога.

### Роли не применяются

**Решение:** Подождите 1-2 минуты, иногда права применяются с задержкой.

